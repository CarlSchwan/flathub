From 8ba84fc1831d29a6d085f7157b29f886ca4ea39e Mon Sep 17 00:00:00 2001
From: Carl Schwan <carl@carlschwan.eu>
Date: Thu, 29 Aug 2024 14:33:06 +0200
Subject: [PATCH] Fix app launcher in flatpak

---
 launcher/Main.qml   | 8 ++++----
 launcher/helper.cpp | 8 +++++---
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/launcher/Main.qml b/launcher/Main.qml
index 7ba864f8e58..0ad57d556c7 100644
--- a/launcher/Main.qml
+++ b/launcher/Main.qml
@@ -47,22 +47,22 @@ Controls.ApplicationWindow {
                 {
                     name: i18n("Calligra Words"),
                     icon: "calligrawords",
-                    desktopId: "org.kde.calligra.words"
+                    desktopId: "calligrawords"
                 },
                 {
                     name: i18n("Calligra Stage"),
                     icon: "calligrasheets",
-                    desktopId: "org.kde.calligra.stage"
+                    desktopId: "calligrastage"
                 },
                 {
                     name: i18n("Calligra Sheets"),
                     icon: "calligrastage",
-                    desktopId: "org.kde.calligra.sheets"
+                    desktopId: "calligrasheets"
                 },
                 {
                     name: i18n("Karbon"),
                     icon: "karbon",
-                    desktopId: "org.kde.calligra.karbon"
+                    desktopId: "karbon"
                 },
                 {
                     name: i18n("Quit"),
diff --git a/launcher/helper.cpp b/launcher/helper.cpp
index d33b4ed0f26..9d48bbdf63a 100644
--- a/launcher/helper.cpp
+++ b/launcher/helper.cpp
@@ -3,7 +3,7 @@
 
 #include "helper.h"
 
-#include <KIO/ApplicationLauncherJob>
+#include <KIO/CommandLauncherJob>
 #include <KIO/JobUiDelegateFactory>
 #include <KJobUiDelegate>
 #include <KService>
@@ -22,9 +22,11 @@ void Helper::execute(const QString &appId)
         qApp->quit();
     }
 
-    KService::Ptr service = KService::serviceByDesktopName(appId);
-    auto job = new KIO::ApplicationLauncherJob(service);
+    auto job = new KIO::CommandLauncherJob(appId, QStringList{});
     connect(job, &KJob::result, this, [job](KJob *) {
+        if (job->error() != KJob::NoError) {
+            qWarning() << job->errorString();
+        }
         qApp->quit();
     });
     job->start();
-- 
2.45.2

